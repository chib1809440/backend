src/
â”œâ”€â”€ main.ts
â”œâ”€â”€ app.module.ts
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ app.config.ts
â”‚   â”œâ”€â”€ database.config.ts
â”‚   â””â”€â”€ env.validation.ts
â”‚
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ guards/
â”‚   â”œâ”€â”€ interceptors/
â”‚   â”œâ”€â”€ filters/
â”‚   â”œâ”€â”€ pipes/
â”‚   â””â”€â”€ decorators/
â”‚
src/
â”œâ”€â”€ modules/
â”‚   â””â”€â”€ order/
â”‚       â”œâ”€â”€ presentation/ (ğŸ‘‰ Nháº­n HTTP, validate input, tráº£ response ğŸ‘‰ KHÃ”NG business logic)
â”‚       â”‚   â””â”€â”€ order.controller.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ application/ (ğŸ‘‰ Äiá»u phá»‘i luá»“ng nghiá»‡p vá»¥ ğŸ‘‰ Gá»i domain, repo, emit event)
â”‚       â”‚   â”œâ”€â”€ commands/
â”‚       â”‚   â”‚   â””â”€â”€ create-order.command.ts
â”‚       â”‚   â”œâ”€â”€ handlers/
â”‚       â”‚   â”‚   â””â”€â”€ create-order.handler.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”‚       â””â”€â”€ create-order.dto.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ domain/ (ğŸ‘‰ KhÃ´ng biáº¿t NestJS ğŸ‘‰ Chá»‰ táº¡o events)
â”‚       â”‚   â”œâ”€â”€ entities/
â”‚       â”‚   â”‚   â””â”€â”€ order.entity.ts
â”‚       â”‚   â”œâ”€â”€ value-objects/
â”‚       â”‚   â”‚   â””â”€â”€ order-id.vo.ts
â”‚       â”‚   â”œâ”€â”€ aggregates/
â”‚       â”‚   â”‚   â””â”€â”€ order.aggregate.ts
â”‚       â”‚   â”œâ”€â”€ events/
â”‚       â”‚   â”‚   â””â”€â”€ order-created.event.ts
â”‚       â”‚   â”œâ”€â”€ repositories/
â”‚       â”‚   â”‚   â””â”€â”€ order.repository.ts
â”‚       â”‚   â””â”€â”€ services/
â”‚       â”‚       â””â”€â”€ order-domain.service.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ infrastructure/
â”‚       â”‚   â”œâ”€â”€ persistence/
â”‚       â”‚   â”‚   â””â”€â”€ prisma-order.repository.ts
â”‚       â”‚   â”œâ”€â”€ mappers/
â”‚       â”‚   â”‚   â””â”€â”€ order.mapper.ts
â”‚       â”‚   â””â”€â”€ messaging/
â”‚       â”‚       â””â”€â”€ order-event.publisher.ts
â”‚       â”‚
â”‚       â””â”€â”€ order.module.ts
â”œâ”€â”€ libs/
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”‚   â””â”€â”€ base.usecase.ts
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ base.entity.ts
â”‚   â”‚   â”‚   â””â”€â”€ aggregate-root.ts
â”‚   â”‚   â”œâ”€â”€ http/
â”‚   â”‚   â”‚   â””â”€â”€ base.controller.ts
â”‚   â”‚   â””â”€â”€ errors/
â”‚   â”‚       â””â”€â”€ base.error.ts
â”‚   â”‚
â”‚   â””â”€â”€ database/
â”‚       â””â”€â”€ prisma/
â”‚           â”œâ”€â”€ prisma.service.ts
â”‚           â””â”€â”€ prisma.module.ts
â”‚
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ e2e/
â”‚
â””â”€â”€ README.md



I. Presentation Layer (Interface / Delivery)
ğŸ¯ TrÃ¡ch nhiá»‡m DUY NHáº¤T
Nháº­n input â€“ tráº£ output

âœ… ÄÆ°á»£c phÃ©p lÃ m
Nháº­n HTTP / GraphQL / gRPC / Message
Parse request
Validate ká»¹ thuáº­t (format, required field)
Map request â†’ command / query
Map result â†’ response
AuthN / AuthZ (role, permission)

âŒ KhÃ´ng Ä‘Æ°á»£c lÃ m
Business rule
Quyáº¿t Ä‘á»‹nh tráº¡ng thÃ¡i
Transaction
Gá»i DB trá»±c tiáº¿p

=======================================================

II. Application Layer (Use Case / Orchestration)
ğŸ¯ TrÃ¡ch nhiá»‡m Cá»T LÃ•I

Äiá»u phá»‘i má»™t use case tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i

Application chá»‹u trÃ¡ch nhiá»‡m:
NhÃ³m	Chi tiáº¿t
Use case	Thá»±c thi 1 hÃ nh Ä‘á»™ng nghiá»‡p vá»¥
Transaction	Báº¯t / commit / rollback
Coordination	Gá»i domain, repo, event
Consistency	Äáº£m báº£o atomicity
Policy	Ai Ä‘Æ°á»£c lÃ m gÃ¬ (business-level)
âœ… ÄÆ°á»£c phÃ©p lÃ m

Gá»i domain entity

Load & save aggregate

Quáº£n lÃ½ transaction

Ghi outbox event

PhÃ¡t domain event (internal)

Retry logic á»Ÿ má»©c use case

âŒ KhÃ´ng Ä‘Æ°á»£c lÃ m

SQL chi tiáº¿t

Business rule phá»©c táº¡p

Logic thay Ä‘á»•i state trá»±c tiáº¿p

Biáº¿t RabbitMQ/Kafka API

==================================================


III. Domain Layer (Business Core)
ğŸ¯ TrÃ¡ch nhiá»‡m DUY NHáº¤T

Äá»‹nh nghÄ©a vÃ  báº£o vá»‡ nghiá»‡p vá»¥

Domain chá»‹u trÃ¡ch nhiá»‡m:
ThÃ nh pháº§n	Vai trÃ²
Entity	Tráº¡ng thÃ¡i + hÃ nh vi
Value Object	GiÃ¡ trá»‹ báº¥t biáº¿n
Aggregate	Consistency boundary
Domain Event	Business fact
Invariant	Luáº­t khÃ´ng Ä‘Æ°á»£c phÃ¡
âœ… ÄÆ°á»£c phÃ©p lÃ m

Validate nghiá»‡p vá»¥

Thay Ä‘á»•i tráº¡ng thÃ¡i ná»™i táº¡i

PhÃ¡t sinh domain event

Throw business error

âŒ Tuyá»‡t Ä‘á»‘i cáº¥m

NestJS decorators

Prisma / ORM

HTTP / MQ

Transaction


====================================================

IV. . Infrastructure Layer (Technical Details)
ğŸ¯ TrÃ¡ch nhiá»‡m DUY NHáº¤T

Triá»ƒn khai chi tiáº¿t ká»¹ thuáº­t

Infrastructure chá»‹u trÃ¡ch nhiá»‡m:
NhÃ³m	VÃ­ dá»¥
Persistence	Prisma / TypeORM
Messaging	RabbitMQ / Kafka
External	Payment Gateway
Scheduler	Cron / Worker
Mapping	Domain â†” DB â†” Event
âœ… ÄÆ°á»£c phÃ©p lÃ m

SQL / Prisma

Serialize message

Retry network

Polling / CDC

Cache

âŒ KhÃ´ng Ä‘Æ°á»£c lÃ m

Quyáº¿t Ä‘á»‹nh nghiá»‡p vá»¥

Thay Ä‘á»•i domain rule

Gá»i trá»±c tiáº¿p domain logic phá»©c táº¡p


=============================================
V.Cross-cutting concerns (á»Ÿ Ä‘Ã¢u?)
Concern	Táº§ng
Logging	Infra
Metrics	Infra
Caching	Infra
Auth (technical)	Presentation
Authorization (business)	Application
Validation (business)	Domain
Validation (format)	Presentation
